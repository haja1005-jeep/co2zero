<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìŠ¤ë§ˆíŠ¸ íƒ„ì†Œì¤‘ë¦½ íŠ¸ë¦¬ë§µ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: 'Noto Sans KR', sans-serif; overflow: hidden; }
        
        /* 1. ì§€ë„ ì „ì²´ í™”ë©´ */
        #map { width: 100vw; height: 100vh; z-index: 1; }

        /* 2. ëŒ€ì‹œë³´ë“œ ì˜¤ë²„ë ˆì´ (ì¢Œì¸¡ ìƒë‹¨) */
        .dashboard-panel {
            position: absolute; top: 20px; left: 20px; width: 300px;
            background: rgba(20, 30, 48, 0.9); /* ë‹¤í¬ ëª¨ë“œ ë°˜íˆ¬ëª… */
            color: #fff; padding: 20px; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 999;
            backdrop-filter: blur(5px);
        }
        .panel-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .stat-item { margin-bottom: 15px; }
        .stat-label { font-size: 12px; color: #aaa; }
        .stat-value { font-size: 24px; font-weight: bold; color: #00e676; } /* í˜•ê´‘ ì´ˆë¡ */
        .stat-unit { font-size: 14px; color: #fff; }

        /* 3. ìƒíƒœ í‘œì‹œ ë§ˆì»¤ ìŠ¤íƒ€ì¼ */
        .status-badge { padding: 2px 6px; border-radius: 4px; font-size: 11px; color: white; }
        .bg-healthy { background-color: #00c853; }
        .bg-warning { background-color: #ffab00; }
    </style>
</head>
<body>

    <div class="dashboard-panel">
        <div class="panel-title">ğŸŒ³ ìŠ¤ë§ˆíŠ¸ íƒ„ì†Œ ê´€ì œ</div>
        
        <div class="stat-item">
            <div class="stat-label">ê´€ë¦¬ ì¤‘ì¸ ìˆ˜ëª©</div>
            <span id="stat-tree-count" class="stat-value">0</span> <span class="stat-unit">ê·¸ë£¨</span>
        </div>

        <div class="stat-item">
            <div class="stat-label">ì‹¤ì‹œê°„ íƒ„ì†Œ í¡ìˆ˜ëŸ‰</div>
            <span id="stat-carbon" class="stat-value">0</span> <span class="stat-unit">kg/ë…„</span>
        </div>

        <div class="stat-item">
            <div class="stat-label">ìŠ¹ìš©ì°¨ ìƒì‡„ íš¨ê³¼</div>
            <span id="stat-cars" class="stat-value" style="color:#29b6f6;">0</span> <span class="stat-unit">ëŒ€ ë¶„ëŸ‰</span>
        </div>
        
        <div style="font-size:11px; color:#666; margin-top:10px;">
            * êµ­ë¦½ì‚°ë¦¼ê³¼í•™ì› í‘œì¤€ ì‚°ì‹ ì ìš©
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. ì§€ë„ ìƒì„± (ì„œìš¸ ì‹œì²­ ì¤‘ì‹¬)
        const map = L.map('map').setView([37.5665, 126.9780], 17);

        // 2. ì§€ë„ íƒ€ì¼ ë ˆì´ì–´ (ì˜¤í”ˆìŠ¤íŠ¸ë¦¬íŠ¸ë§µ - ë¬´ë£Œ)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // 3. PHP API ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function loadTreeData() {
            try {
                const response = await fetch('api_trees.php'); // PHP íŒŒì¼ í˜¸ì¶œ
                const data = await response.json();

                // 3-1. ëŒ€ì‹œë³´ë“œ ìˆ«ì ì—…ë°ì´íŠ¸ (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ê°€ëŠ¥)
                document.getElementById('stat-tree-count').innerText = data.stats.total_trees;
                document.getElementById('stat-carbon').innerText = data.stats.total_carbon;
                document.getElementById('stat-cars').innerText = data.stats.car_equivalent;

                // 3-2. ì§€ë„ì— ë§ˆì»¤ ì°ê¸°
                L.geoJSON(data, {
                    pointToLayer: function (feature, latlng) {
                        // ë‚˜ë¬´ ìƒíƒœì— ë”°ë¼ ìƒ‰ìƒ ë³€ê²½
                        let color = feature.properties.status === 'healthy' ? '#00e676' : '#ff3d00';
                        return L.circleMarker(latlng, {
                            radius: 8,
                            fillColor: color,
                            color: "#fff",
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 0.8
                        });
                    },
                    onEachFeature: function (feature, layer) {
                        // í´ë¦­ ì‹œ íŒì—… ì •ë³´
                        layer.bindPopup(`
                            <b>ğŸŒ² ìˆ˜ì¢…: ${feature.properties.species}</b><br>
                            ì§ê²½: ${feature.properties.dbh}cm<br>
                            <b>COâ‚‚ í¡ìˆ˜: ${feature.properties.co2}kg</b>
                        `);
                    }
                }).addTo(map);

            } catch (error) {
                console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                alert('ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹¤í–‰
        loadTreeData();
    </script>
</body>
</html>